"use strict";(self.webpackChunkcontrast_docs=self.webpackChunkcontrast_docs||[]).push([[5541],{2504:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var i=t(4848),r=t(8453);const s={},a="Attestation in Contrast",o={id:"architecture/attestation",title:"Attestation in Contrast",description:"Introduction",source:"@site/docs/architecture/attestation.md",sourceDirName:"architecture",slug:"/architecture/attestation",permalink:"/contrast/pr-preview/pr-393/next/architecture/attestation",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Architecture",permalink:"/contrast/pr-preview/pr-393/next/architecture/"},next:{title:"Certificates and Identities",permalink:"/contrast/pr-preview/pr-393/next/category/certificates-and-identities"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Attestation Architecture",id:"attestation-architecture",level:2},{value:"Components of Contrast&#39;s Attestation",id:"components-of-contrasts-attestation",level:2},{value:"Attester: Application Pods",id:"attester-application-pods",level:3},{value:"Verifier: Coordinator and CLI",id:"verifier-coordinator-and-cli",level:3},{value:"Relying Party: Data Owner",id:"relying-party-data-owner",level:3},{value:"Interaction Between Components",id:"interaction-between-components",level:3},{value:"Evidence Generation and Appraisal",id:"evidence-generation-and-appraisal",level:2},{value:"Evidence Types and Formats",id:"evidence-types-and-formats",level:3},{value:"Appraisal Policies for Evidence",id:"appraisal-policies-for-evidence",level:3},{value:"Summary",id:"summary",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"attestation-in-contrast",children:"Attestation in Contrast"}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["This document describes the attestation architecture of Contrast, adhering to the definitions of Remote ATtestation procedureS (RATS) in ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc9334/",children:"RFC 9334"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"attestation-architecture",children:"Attestation Architecture"}),"\n",(0,i.jsxs)(n.p,{children:["Contrast integrates with the RATS architecture, leveraging their definition of roles and processes including ",(0,i.jsx)(n.em,{children:"Attesters"}),", ",(0,i.jsx)(n.em,{children:"Verifiers"}),", and ",(0,i.jsx)(n.em,{children:"Relying Parties"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"     .--------.     .---------.       .--------.       .-------------.\n    | Endorser |   | Reference |     | Verifier |     | Relying Party |\n     '-+------'    | Value     |     | Owner    |     | Owner         |\n       |           | Provider  |      '---+----'       '----+--------'\n       |            '-----+---'           |                 |\n       |                  |               |                 |\n       | Endorsements     | Reference     | Appraisal       | Appraisal\n       |                  | Values        | Policy for      | Policy for\n       |                  |               | Evidence        | Attestation\n        '-----------.     |               |                 | Results\n                     |    |               |                 |\n                     v    v               v                 |\n                   .-------------------------.              |\n           .------\x3e|         Verifier        +-----.        |\n          |        '-------------------------'      |       |\n          |                                         |       |\n          | Evidence                    Attestation |       |\n          |                             Results     |       |\n          |                                         |       |\n          |                                         v       v\n    .-----+----.                                .---------------.\n    | Attester |                                | Relying Party |\n    '----------'                                '---------------'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Figure 1: Conceptual Data Flow. Taken from ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc9334/",children:"RFC 9334"}),"."]}),"\n",(0,i.jsx)(n.mermaid,{value:'block-beta\ncolumns 4\n        A["Endorser"] B["Reference Value Provider"] C["Verifier Owner"] D["Relying Party Owner"]\n        space:4\n        space:4\n        space:4\n        space:4\n        space E["Verifier"]:2 space\n        space:4\n        space:4\n        space:4\n        space:4\n        F["Attester"] space space G["Relying Party"]\n\n        A-- "Endorsements" --\x3eE\n        B-- "Reference\\nValues" --\x3eE\n        C-- "Appraisal\\nPolicy\\nfor Evidence" --\x3eE\n        F-- "Evidence" --\x3eE\n        D-- "Appraisal Policy for\\nAttestation Results" --\x3eG\n        E-- "Attestation\\nResults" --\x3eG'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attester"}),": Assigned to entities that are responsible for creating ",(0,i.jsx)(n.em,{children:"Evidence"})," which is then sent to a ",(0,i.jsx)(n.em,{children:"Verifier"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verifier"}),": These entities utilize the ",(0,i.jsx)(n.em,{children:"Evidence"}),", ",(0,i.jsx)(n.em,{children:"Reference Values"}),", and ",(0,i.jsx)(n.em,{children:"Endorsements"}),". They assess the trustworthiness of the ",(0,i.jsx)(n.em,{children:"Attester"})," by applying an ",(0,i.jsx)(n.em,{children:"Appraisal Policy"})," for ",(0,i.jsx)(n.em,{children:"Evidence"}),', a process known as "appraisal of Evidence." Following this assessment, ',(0,i.jsx)(n.em,{children:"Verifiers"})," generate ",(0,i.jsx)(n.em,{children:"Attestation Results"})," for use by ",(0,i.jsx)(n.em,{children:"Relying Parties"}),". The ",(0,i.jsx)(n.em,{children:"Appraisal Policy"})," for ",(0,i.jsx)(n.em,{children:"Evidence"})," may be provided by the ",(0,i.jsx)(n.em,{children:"Verifier Owner"}),", configured by the owner, programmed into the ",(0,i.jsx)(n.em,{children:"Verifier"}),", or acquired through other means."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relying Party"}),": Assigned to entities that utilize ",(0,i.jsx)(n.em,{children:"Attestation Results"}),', applying their own appraisal policies to make specific decisions, such as authorization decisions. This process is referred to as the "appraisal of Attestation Results." The ',(0,i.jsx)(n.em,{children:"Appraisal Policy"})," for ",(0,i.jsx)(n.em,{children:"Attestation Results"})," might be sourced from the ",(0,i.jsx)(n.em,{children:"Relying Party Owner"}),", configured by the owner, embedded in the ",(0,i.jsx)(n.em,{children:"Relying Party"}),", or obtained through other protocols or mechanisms."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"components-of-contrasts-attestation",children:"Components of Contrast's Attestation"}),"\n",(0,i.jsx)(n.p,{children:"The key components involved in the attestation process of Contrast are detailed below:"}),"\n",(0,i.jsx)(n.h3,{id:"attester-application-pods",children:"Attester: Application Pods"}),"\n",(0,i.jsxs)(n.p,{children:["This includes all Pods of the Contrast deployment that run inside Confidential Containers and generate cryptographic evidence reflecting their current configuration and state.\nTheir evidence is rooted in the ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/basics/confidential-containers",children:"hardware measurements"})," from the CPU and their ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/runtime",children:"confidential VM environment"}),".\nThe details of this evidence are given below in the section on ",(0,i.jsx)(n.a,{href:"#evidence-generation-and-appraisal",children:"Evidence Generation and Appraisal"}),".\nIn RATS terminology, these Pods implement a layered attestation environment:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"              .-------------.\n              |    CPU      |   Endorsement for CPU\n              |   Vendor    +-----------------------.\n              '-------------'                       |\n                                                    v\n              .-------------.   Reference      .-------------.\n              | CLI +       |   Values for     |             |\n              | Edgeless    +-----------------\x3e| Coordinator |\n              | Systems     | CPU and Image,   |             |\n              '-------------'                  '-------------'\n                                                    ^\n          .------------------------------------.    |\n          |                                    |    | Layered\n          |                                    |    | Evidence\n          |   .---------------------------.    |    |   for\n          |   | Initializer(C)            |    |    |  Image\n          |   |             .-----------. |    |    |   and\n          |   |   Target    | Attesting | |    |    |   CPU\n          |   | Environment |Environment+-----------'\n          |   |             |           | |    |\n          |   |             '-----------' |    |\n          |   |                 ^         |    |\n          |   '--------------+--|---------'    |\n          |          Collect |  | Evidence for |\n          |          Claims  v  | Initializer  |\n          |   .-----------------+---------.    |\n          |   | Image(B):                 |    |\n          |   | Kernel, initrd,           |    |\n          |   | cmdline          Target   |    |\n          |   |               Environment |    |\n          |   |                 ^         |    |\n          |   '-------------+--|---------'     |\n          |         Collect |  | Evidence for  |\n          |         Claims  v  |  Kernel and   |\n          |                    | Runtime Policy|\n          |   .----------------+----------.    |\n          |   | CPU(A)                    |    |\n          |   | AMD SEV,                  |    |\n          |   | Intel TDX     Target      |    |\n          |   |              Environment  |    |\n          |   '---------------------------'    |\n          |                                    |\n          '------------------------------------'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Figure 2: Layered Attester. Taken from ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc9334/",children:"RFC 9334"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["These pods run in Contrast's ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/runtime",children:"runtime environment"}),", effectively within a confidential VM.\nDuring launch, the CPU measures the initial memory content of the confidential VM that contains Contrast's pod-VM image and generates the corresponding attestation evidence.\nThe image is in ",(0,i.jsx)(n.a,{href:"https://github.com/microsoft/igvm",children:"IGVM format"}),", encapsulating all information required to launch a virtual machine, including the kernel, the initramfs, and kernel cmdline.\nThe kernel cmdline contains the root hash for ",(0,i.jsx)(n.a,{href:"https://www.kernel.org/doc/html/latest/admin-guide/device-mapper/verity.html",children:"dm-verity"})," that ensures the integrity of the root filesystem.\nThe root filesystem contains the ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/#the-initializer",children:"initializer"})," and all other components of the container's runtime environment such as the ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/basics/confidential-containers#kata-containers",children:"guest agent"}),".\nTherefore, the dm-verity root hash acts as the evidence for all userland components that are part of the root filesystem."]}),"\n",(0,i.jsxs)(n.p,{children:["In the userland, the guest agent takes care of enforcing the containers ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/#runtime-policies",children:"runtime policy"}),".\nWhile the policy is passed in during the initialization procedure via the Kata host, the evidence for the runtime policy is part of the CPU measurements.\nDuring the ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/deployment#generate-policy-annotations-and-manifest",children:"deployment"})," the expected policy hash is annotated to the Kubernetes Pod resources.\nOn AMD SEV-SNP system's the policy's hash is then added to the CPU's attestation report via the ",(0,i.jsx)(n.code,{children:"HOSTDATA"})," field by the hypervisor.\nWhen provided with the policy from the Kata host, the guest agent verifies that the policy's hash matches the one in the ",(0,i.jsx)(n.code,{children:"HOSTDATA"})," field."]}),"\n",(0,i.jsx)(n.p,{children:"In summary the Pod's evidence consists of the CPU report, the pod-VM image's measurements, and the runtime policy.\nAll of this layered evidence  is combined into one statement and passed to the verifier."}),"\n",(0,i.jsx)(n.h3,{id:"verifier-coordinator-and-cli",children:"Verifier: Coordinator and CLI"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/#the-coordinator",children:"Coordinator"})," acts as a verifier within the Contrast deployment, configured with a ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/#the-manifest",children:"Manifest"})," that defines the reference values and serves as an appraisal policy for all pods in the deployment.\nIt also pulls endorsements from hardware vendors to verify the hardware claims.\nThe Coordinator operates within the cluster as a confidential container and provides similar evidence as any other Pod when it acts as an attester.\nIn RATS terminology, the Coordinator's dual role is defined as a lead attester in a composite device which spans the entire deployment: Coordinator and the workload pods.\nIt collects evidence from other attesters and conveys it to a verifier, generating evidence about the layout of the whole composite device based on the Manifest as the appraisal policy."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"                      .-----------------------------.\n                      |           Verifier          |\n                      '-----------------------------'\n                                      ^\n                                      |\n                                      | Evidence of\n                                      | Composite Device\n                                      |\n   .----------------------------------|-------------------------------.\n   | .--------------------------------|-----.      .------------.     |\n   | |  Collect             .---------+--.  |      |            |     |\n   | |  Claims   .---------\x3e|  Attesting |<--------+ Pod A      +-.   |\n   | |           |          |Environment |  |      '-+----------' |   |\n   | |  .--------+-------.  |            |<----------+ Pod B      +-. |\n   | |  | Runtime Target |  |            |  |        '-+----------' | |\n   | |  | Environment    |  |            |<------------+ ...        | |\n   | |  |                |  '------------'  | Evidence '------------' |\n   | |  '----------------'                  |    of                   |\n   | |                                      |   Pods                  |\n   | | Coordinator                          | (via Pod network)       |\n   | '--------------------------------------'                         |\n   |                                                                  |\n   |                       Composite Device                           |\n   '------------------------------------------------------------------'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Figure 3: Composite Device. Taken from ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/rfc9334/",children:"RFC 9334"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/components/#the-cli-command-line-interface",children:"CLI"})," serves as the verifier for the Coordinator and the entire Contrast deployment, containing the reference values for the Coordinator and the endorsements from hardware vendors.\nThese reference values are built into the Coordinator during our release process and can be reproduced offline via reproducible builds."]}),"\n",(0,i.jsx)(n.h3,{id:"relying-party-data-owner",children:"Relying Party: Data Owner"}),"\n",(0,i.jsxs)(n.p,{children:["A relying party in the Contrast scenario could be, for example, the ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/basics/security-benefits",children:"data owner"})," that interacts with the application.\nThe relying party or the relying party owner can use the CLI to obtain the attestation results and Contrast's ",(0,i.jsx)(n.a,{href:"/contrast/pr-preview/pr-393/next/architecture/certificates-and-identities/pki",children:"CA certificates"})," bound to these results.\nThe CA certificates can then be used by the relying party to authenticate the application, for example through TLS connections."]}),"\n",(0,i.jsx)(n.h3,{id:"interaction-between-components",children:"Interaction Between Components"}),"\n",(0,i.jsx)(n.p,{children:"All connections between components such as the CLI, the Coordinator, and the Pods occur through secure channels, ensuring that evidence transmission and attestation results are safeguarded against unauthorized access."}),"\n",(0,i.jsx)(n.h2,{id:"evidence-generation-and-appraisal",children:"Evidence Generation and Appraisal"}),"\n",(0,i.jsx)(n.h3,{id:"evidence-types-and-formats",children:"Evidence Types and Formats"}),"\n",(0,i.jsx)(n.p,{children:"Several types of attestation evidence exist in Contrast:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The hardware attestation report"}),": For AMD SEV-SNP, this includes information such as chip identifier, platform info, microcode versions, and guest measurements. The report also contains the runtime policy hash and is signed by the CPU's private key."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The guest measurements"}),": A launch digest generated by the CPU, which is the hash of all initial guest memory pages, containing the kernel, initramfs, and kernel command line including the root filesystem's dm-verity root hash."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The runtime policy hash"}),": The hash of the Rego policy that defines all expected API commands and their values from the host to the Kata guest agent, including the dm-verity hashes for the container image layers, environment variables, and mount points."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"appraisal-policies-for-evidence",children:"Appraisal Policies for Evidence"}),"\n",(0,i.jsx)(n.p,{children:"The appraisal policies in Contrast consist of two parts:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The Manifest"}),": A JSON file configuring the Coordinator with reference values for the runtime policy hashes for each pod in the deployment and the expected hardware attestation report evidence."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The CLI's appraisal policy"}),": Contains the Coordinator's guest measurements and its runtime policy. The policy is baked into the CLI during the build process and can be compared against the source code reference via reproducible builds."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In summary, Contrast's attestation strategy follows the RATS guidelines and consists of two parts:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A layered attestation environment for each individual instance of a Confidential Container in the deployment."}),"\n",(0,i.jsx)(n.li,{children:"The Coordinator attestation service as a lead attester that allows the transitive verification of the entire deployment as composite device."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(6540);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);